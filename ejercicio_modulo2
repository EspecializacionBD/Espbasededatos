-- Crear base de datos
CREATE DATABASE exito_db;
USE exito_db;

-- Tabla: clientes
CREATE TABLE clientes (
  id_cliente INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  correo VARCHAR(100) NOT NULL,
  telefono VARCHAR(20),
  direccion VARCHAR(150)
);

-- Tabla: productos
CREATE TABLE productos (
  id_producto INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  categoria VARCHAR(50),
  precio DECIMAL(10,2) NOT NULL,
  stock INT NOT NULL
);

-- Tabla: pedidos
CREATE TABLE pedidos (
  id_pedido INT AUTO_INCREMENT PRIMARY KEY,
  fecha DATE NOT NULL,
  id_cliente INT,
  estado VARCHAR(50) DEFAULT 'Pendiente',
  FOREIGN KEY (id_cliente) REFERENCES clientes(id_cliente)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

-- Tabla: detalle_pedidos (relaciona pedidos y productos)
CREATE TABLE detalle_pedidos (
  id_detalle INT AUTO_INCREMENT PRIMARY KEY,
  id_pedido INT,
  id_producto INT,
  cantidad INT NOT NULL,
  precio_unitario DECIMAL(10,2) NOT NULL,
  FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  FOREIGN KEY (id_producto) REFERENCES productos(id_producto)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

-- Tabla: pagos
CREATE TABLE pagos (
  id_pago INT AUTO_INCREMENT PRIMARY KEY,
  id_pedido INT,
  fecha_pago DATE NOT NULL,
  monto DECIMAL(10,2) NOT NULL,
  metodo_pago VARCHAR(50) NOT NULL,
  FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido)
    ON DELETE SET NULL
    ON UPDATE CASCADE
);

-- Tabla: domicilios (para la logística de entrega)
CREATE TABLE domicilios (
  id_domicilio INT AUTO_INCREMENT PRIMARY KEY,
  id_pedido INT,
  direccion_entrega VARCHAR(150) NOT NULL,
  fecha_entrega DATE,
  estado_entrega VARCHAR(50) DEFAULT 'En proceso',
  FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

-- Tabla: programas_fidelizacion
CREATE TABLE programas_fidelizacion (
  id_fidelizacion INT AUTO_INCREMENT PRIMARY KEY,
  id_cliente INT,
  puntos INT DEFAULT 0,
  nivel VARCHAR(50) DEFAULT 'Bronce',
  FOREIGN KEY (id_cliente) REFERENCES clientes(id_cliente)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

-- Insertar datos ejemplo en clientes
INSERT INTO clientes (nombre, correo, telefono, direccion) VALUES
('Laura Gómez', 'laura.gomez@exito.com', '3001234567', 'Calle 10 #20-30'),
('Andrés Rojas', 'andres.rojas@exito.com', '3007654321', 'Carrera 45 #15-60'),
('Diana Torres', 'diana.torres@exito.com', '3012345678', 'Avenida 68 #80-20');

-- Insertar datos ejemplo en productos
INSERT INTO productos (nombre, categoria, precio, stock) VALUES
('Arroz Diana 500g', 'Alimentos', 2500, 100),
('Camiseta Hombre', 'Ropa', 35000, 50),
('Televisor 32" LG', 'Tecnología', 1200000, 10),
('Licuadora Oster', 'Hogar', 250000, 20);

-- Insertar datos ejemplo en pedidos
INSERT INTO pedidos (fecha, id_cliente, estado) VALUES
('2025-06-20', 1, 'Completado'),
('2025-06-21', 2, 'Pendiente'),
('2025-06-22', 1, 'En proceso'),
('2025-06-22', 3, 'Pendiente');

-- Insertar detalle de pedidos
INSERT INTO detalle_pedidos (id_pedido, id_producto, cantidad, precio_unitario) VALUES
(1, 1, 2, 2500),
(1, 2, 1, 35000),
(2, 3, 1, 1200000),
(3, 4, 1, 250000),
(4, 1, 3, 2500);

-- Insertar pagos
INSERT INTO pagos (id_pedido, fecha_pago, monto, metodo_pago) VALUES
(1, '2025-06-20', 40000, 'Tarjeta crédito'),
(2, '2025-06-21', 1200000, 'PSE');

-- Insertar domicilios
INSERT INTO domicilios (id_pedido, direccion_entrega, fecha_entrega, estado_entrega) VALUES
(1, 'Calle 10 #20-30', '2025-06-21', 'Entregado'),
(2, 'Carrera 45 #15-60', NULL, 'En proceso'),
(3, 'Calle 10 #20-30', NULL, 'En proceso');

-- Insertar fidelización
INSERT INTO programas_fidelizacion (id_cliente, puntos, nivel) VALUES
(1, 150, 'Plata'),
(2, 50, 'Bronce'),
(3, 80, 'Bronce');
